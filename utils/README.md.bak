# Utils

## Mounting web-dav server
Since we are using large LiDAR data sets we can't copy all the data to our laptops and computers. The most efficient way to access the data is to mount our `webdav storage` as local file system. The detailed steps on how to do it in Windows and Linux are in the coming sub-sections.

### Windows
To mount eEcolidar webdav storage in Windows we can use [winfsp](https://github.com/billziss-gh/winfsp). To mount the eEcolidar just follow the [winfsp instructions](https://github.com/billziss-gh/winfsp#winfsp---windows-file-system-proxy). As folder in the `winfsp interface` just add `https://webdav.grid.surfsara.nl/pnfs/grid.sara.nl/data/projects.nl/eecolidar/`. For login you just need to add your credentials.

If you prefere a command line approach the you should do the following:
```
#To mount it as drive w:
net use w: https://webdav.grid.surfsara.nl/pnfs/grid.sara.nl/data/projects.nl/eecolidar/

#To unmount it
net use w: /delete
```

### Linux

In Linux we use [rclone](https://rclone.org/install/) which is a command line tool which uses `fuse` to mount different type of storages. For eEcolidar we use the `webdav` storage type. After installing `rclone` you need to configure it calling the command `rclone config`.
```
ecolidar:~$ rclone config
```
The following menu will appear and you should enter `n`.
```
2018/09/07 11:21:45 NOTICE: Config file "/home/eecolidar/.config/rclone/rclone.conf" not found - using defaults
No remotes found - make a new one
n) New remote
s) Set configuration password
q) Quit config
n/s/q>
```
Then you should enter the name for the connection to a remote storage. For this example we use `ecolidar_webdav`, but you can pick a name at your convennience.
```
n/s/q> n
name> eecolidar_webdav
```
For `type of storage` you should pick `Webdav`, i.e., the number `23`.
```
...
20 / Pcloud
   \ "pcloud"
21 / QingCloud Object Storage
   \ "qingstor"
22 / SSH/SFTP Connection
   \ "sftp"
23 / Webdav
   \ "webdav"
24 / Yandex Disk
   \ "yandex"
25 / http Connection
   \ "http"
Storage> 23
```
For storage `url` you should enter `https://webdav.grid.surfsara.nl/pnfs/grid.sara.nl/data/projects.nl/eecolidar/`;
```
Storage> 23
URL of http host to connect to
Enter a string value. Press Enter for the default ("").
Choose a number from below, or type in your own value
 1 / Connect to example.com
   \ "https://example.com"
url> https://webdav.grid.surfsara.nl/pnfs/grid.sara.nl/data/projects.nl/eecolidar/
```
For the vendor you should choose `4 / Other site/service or software`.
```
url> https://webdav.grid.surfsara.nl/pnfs/grid.sara.nl/data/projects.nl/eecolidar/
Name of the Webdav site/service/software you are using
Enter a string value. Press Enter for the default ("").
Choose a number from below, or type in your own value
 1 / Nextcloud
   \ "nextcloud"
 2 / Owncloud
   \ "owncloud"
 3 / Sharepoint
   \ "sharepoint"
 4 / Other site/service or software
   \ "other"
vendor> 4
```
For log in enter your `user name`, in this example we use `eecolidar` as user name.
```
vendor> 4
User name
Enter a string value. Press Enter for the default ("").
user> ecolidar
```
For automatic login the password it is possible to add it to the login information. NOTE: it will be encrypted and not saved as plain text in the configuration file.
It also gives the possibility to request a `token` instead of a `user name` and `password` at login time.
```
user> ecolidar
Password.
y) Yes type in my own password
g) Generate random password
n) No leave this optional password blank
y/g/n> y
Enter the password:
password:
Confirm the password:
password:
Bearer token instead of user/pass (eg a Macaroon)
Enter a string value. Press Enter for the default ("").
bearer_token>
Remote config
```

After inserting the login information, rclone will ask to confirm the information added.
```
--------------------
[eecolidar_webdav]
type = webdav
url = https://webdav.grid.surfsara.nl/pnfs/grid.sara.nl/data/projects.nl/eecolidar/
vendor = other
user = ecolidar
pass = *** ENCRYPTED ***
--------------------
y) Yes this is OK
e) Edit this remote
d) Delete this remote
y/e/d> y
```

If all the information is correct you can quit `rclone config`, option `q`.
```
Name                 Type
====                 ====
eecolidar_webdav     webdav

e) Edit existing remote
n) New remote
d) Delete remote
r) Rename remote
c) Copy remote
s) Set configuration password
q) Quit config
e/n/d/r/c/s/q> q
ecolidar:~$
```

As the menu above shows, it is possible to re-configure the setup. Once it is configured the next step is to mount it. For this example we use the location `/data/local/eecolidar_webdav`. The location `/data/local/eecolidar/rclone/tmp/` is used by rclone to cache the files it downloads from our `webdav storage`.
```
rclone mount eecolidar_webdav: /data/local/eecolidar_webdav/ --allow-other --vfs-cache-mode full --daemon --log-file=/data/local/eecolidar/rclone/rclone_log.out --log-level DEBUG --cache-dir /data/local/eecolidar/rclone/tmp/ --cache-db-purge --vfs-cache-max-age 20m0s --dir-cache-time 15m0s --cache-workers=6
```
When the operations over the files is short and many happen in parallel, we recommend small time values for `--vfs-cache-max-age` and `--dir-cache-time`, i.e., between two and five minutes. Otherwise, use the ones in the example.

To unmount you only need to make none of the files or directories under `/data/local/eecolidar_webdav/` are being used.
```
fusermount -u  /data/local/eecolidar_webdav/
```
